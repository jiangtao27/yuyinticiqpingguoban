<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>ç”µå½±çº§æè¯å™¨</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
            -webkit-touch-callout: none;
            user-select: none;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "SF Pro Display", sans-serif;
            background: #000;
            color: #fff;
            overflow: hidden;
            touch-action: manipulation;
        }

        /* å¯åŠ¨é¡µ */
        .start-screen {
            position: fixed;
            inset: 0;
            background: #000;
            display: flex;
            flex-direction: column;
            padding: 40px 30px;
            z-index: 1000;
            overflow-y: auto;
        }

        .start-screen.hidden { display: none; }

        .logo {
            font-size: 40px;
            margin-bottom: 10px;
        }

        .title {
            font-size: 32px;
            font-weight: 700;
            margin-bottom: 8px;
            background: linear-gradient(135deg, #30D158 0%, #0A84FF 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .subtitle {
            color: #8E8E93;
            font-size: 16px;
            margin-bottom: 30px;
        }

        textarea {
            width: 100%;
            flex: 1;
            background: #1C1C1E;
            border: 1px solid #2C2C2E;
            border-radius: 16px;
            padding: 20px;
            color: #fff;
            font-size: 17px;
            line-height: 1.5;
            resize: none;
            margin-bottom: 15px;
            -webkit-user-select: text;
        }

        .btn {
            background: #30D158;
            color: #000;
            border: none;
            padding: 18px;
            border-radius: 14px;
            font-size: 17px;
            font-weight: 600;
            cursor: pointer;
            margin-bottom: 10px;
        }

        .btn.secondary {
            background: #2C2C2E;
            color: #0A84FF;
        }

        /* æè¯å™¨ä¸»ç•Œé¢ */
        .prompter {
            display: none;
            position: fixed;
            inset: 0;
            background: #000;
            overflow: hidden;
        }

        .prompter.active {
            display: block;
        }

        /* æ»šåŠ¨èˆå° - è¿ç»­æ»šåŠ¨æ ¸å¿ƒ */
        .stage {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
            perspective: 1000px;
        }

        .scroll-track {
            position: absolute;
            width: 100%;
            padding: 0 40px;
            transition: transform 0.1s linear; /* å¹³æ»‘æ»šåŠ¨ */
            will-change: transform;
        }

        .line {
            text-align: center;
            font-size: 36px;
            line-height: 1.6;
            padding: 20px 0;
            color: rgba(255,255,255,0.25);
            transition: all 0.3s ease;
            font-weight: 400;
            letter-spacing: 0.5px;
            min-height: 1.6em;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* å½“å‰è¡Œé«˜äº® - åœ¨å±å¹•ä¸­å¤®åä¸‹ä½ç½® */
        .line.active {
            color: #fff;
            font-weight: 600;
            text-shadow: 0 0 30px rgba(255,255,255,0.2);
            transform: scale(1.05);
        }

        .line.prev {
            color: rgba(255,255,255,0.1);
        }

        /* æ¨ªå±ä¼˜åŒ– */
        @media (orientation: landscape) {
            .line {
                font-size: 48px;
                padding: 25px 0;
            }
            .line.active {
                font-size: 52px;
            }
        }

        /* iPad æ¨ªå±æ›´å¤§å­—ä½“ */
        @media (min-width: 1024px) and (orientation: landscape) {
            .line {
                font-size: 64px;
                padding: 30px 0;
            }
            .line.active {
                font-size: 72px;
            }
        }

        /* æ§åˆ¶æ  - æ‚¬æµ®åº•éƒ¨ */
        .controls {
            position: absolute;
            bottom: 40px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(30,30,30,0.8);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            padding: 10px;
            border-radius: 35px;
            display: flex;
            gap: 10px;
            border: 1px solid rgba(255,255,255,0.1);
            z-index: 100;
            transition: opacity 0.3s;
        }

        .controls.hidden {
            opacity: 0;
            pointer-events: none;
        }

        .ctrl-btn {
            width: 55px;
            height: 55px;
            border-radius: 50%;
            border: none;
            background: transparent;
            color: #fff;
            font-size: 22px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s;
        }

        .ctrl-btn:active {
            transform: scale(0.9);
            background: rgba(255,255,255,0.1);
        }

        .ctrl-btn.main {
            background: #30D158;
            color: #000;
            width: 65px;
            height: 65px;
            font-size: 28px;
        }

        .ctrl-btn.main.recording {
            background: #FF3B30;
            animation: pulse 2s infinite;
        }

        .ctrl-btn.small {
            width: 45px;
            height: 45px;
            font-size: 18px;
            color: #8E8E93;
        }

        @keyframes pulse {
            0%, 100% { box-shadow: 0 0 0 0 rgba(255,59,48,0.4); }
            50% { box-shadow: 0 0 0 15px rgba(255,59,48,0); }
        }

        /* é¡¶éƒ¨çŠ¶æ€æ  */
        .top-bar {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            padding: 15px 25px;
            padding-top: max(15px, env(safe-area-inset-top));
            display: flex;
            justify-content: space-between;
            align-items: center;
            z-index: 100;
            background: linear-gradient(to bottom, rgba(0,0,0,0.8), transparent);
            pointer-events: none;
        }

        .status-chip {
            background: rgba(60,60,67,0.6);
            backdrop-filter: blur(10px);
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 13px;
            color: #fff;
            pointer-events: auto;
        }

        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #8E8E93;
            display: inline-block;
            margin-right: 6px;
        }

        .status-dot.active {
            background: #30D158;
            box-shadow: 0 0 0 3px rgba(48,209,88,0.3);
        }

        /* é€Ÿåº¦/çŠ¶æ€æŒ‡ç¤ºå™¨ */
        .hud {
            position: absolute;
            top: 80px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0,0,0,0.6);
            padding: 8px 20px;
            border-radius: 20px;
            font-size: 13px;
            color: #8E8E93;
            opacity: 0;
            transition: opacity 0.3s;
            pointer-events: none;
            white-space: nowrap;
        }

        .hud.show {
            opacity: 1;
        }

        .speed-bar {
            display: inline-block;
            width: 40px;
            height: 4px;
            background: rgba(255,255,255,0.2);
            border-radius: 2px;
            margin: 0 8px;
            vertical-align: middle;
            overflow: hidden;
        }

        .speed-fill {
            height: 100%;
            background: #30D158;
            border-radius: 2px;
            transition: width 0.3s;
        }

        /* æç¤º */
        .toast {
            position: fixed;
            top: 100px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(60,60,67,0.95);
            color: #fff;
            padding: 12px 24px;
            border-radius: 25px;
            font-size: 15px;
            opacity: 0;
            transition: opacity 0.3s;
            z-index: 1000;
            pointer-events: none;
        }

        .toast.show {
            opacity: 1;
        }

        /* æ¨ªå±æ—‹è½¬æç¤º */
        .rotate-hint {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0,0,0,0.9);
            padding: 20px 30px;
            border-radius: 16px;
            text-align: center;
            display: none;
            z-index: 500;
        }

        .rotate-hint.show {
            display: block;
        }
    </style>
</head>
<body>

    <!-- å¯åŠ¨é¡µ -->
    <div class="start-screen" id="startScreen">
        <div class="logo">ğŸ¬</div>
        <div class="title">ç”µå½±çº§æè¯å™¨</div>
        <div class="subtitle">é¢„åˆ¤æ»šåŠ¨ Â· æ¨ªå±å…¨å± Â· ä¸æ»‘æµç•…</div>
        
        <textarea id="scriptInput" placeholder="ç²˜è´´å°è¯ï¼Œæ¯è¡Œä¸€å¥...">æ¬¢è¿ä½¿ç”¨ç”µå½±çº§æè¯å™¨
è¿™æ˜¯ç¬¬ä¸€å¥å°è¯
ä½ ä¼šå‘ç°æ–‡å­—æ˜¯è¿ç»­æµåŠ¨çš„
ä¸åƒä¹‹å‰é‚£æ ·ä¸€è·³ä¸€è·³
å½“å‰è¿™è¡Œä¼šåœ¨å±å¹•ä¸­å¤®
ä½†ä¸‹é¢ä¸€è¡Œæ­£åœ¨æ…¢æ…¢ä¸Šæ¥
ç»™ä½ å……è¶³çš„é¢„åˆ¤æ—¶é—´
è¯»å¾—å¿«å°±æ»šå¾—å¿«
è¯»å¾—æ…¢å°±æ»šå¾—æ…¢
æ¨ªå±çœ‹æ•ˆæœæ›´ä½³
æ”¯æŒè“ç‰™é¥æ§å™¨
ç¥ä½ æ¼”è®²æˆåŠŸ</textarea>
        
        <button class="btn" onclick="start()">å¼€å§‹æ¼”è®²</button>
        <button class="btn secondary" onclick="toggleFullscreen()">å…¨å±æ¨¡å¼</button>
        
        <div style="color: #8E8E93; font-size: 13px; text-align: center; margin-top: 20px; line-height: 1.5;">
            ğŸ’¡ æç¤ºï¼šæ¨ªå±å¯è·å¾—æ›´å¤§å­—ä½“<br>
            åŒæŒ‡ç‚¹å‡»å±å¹•éšè—/æ˜¾ç¤ºæŒ‰é’®
        </div>
    </div>

    <!-- æè¯å™¨ä¸»ç•Œé¢ -->
    <div class="prompter" id="prompter">
        <div class="top-bar">
            <div class="status-chip">
                <span class="status-dot" id="statusDot"></span>
                <span id="statusText">å°±ç»ª</span>
            </div>
            <div class="status-chip" id="progressChip">1/10</div>
        </div>

        <div class="hud" id="hud">
            è¯­é€Ÿ <div class="speed-bar"><div class="speed-fill" id="speedFill" style="width: 50%"></div></div> <span id="wpm">120</span> WPM
        </div>

        <div class="rotate-hint" id="rotateHint">
            <div style="font-size: 40px; margin-bottom: 10px;">ğŸ“±</div>
            <div>æ—‹è½¬æ‰‹æœºæ¨ªå±ä½“éªŒæ›´ä½³</div>
        </div>

        <!-- è¿ç»­æ»šåŠ¨èˆå° -->
        <div class="stage" id="stage">
            <div class="scroll-track" id="track">
                <!-- åŠ¨æ€ç”Ÿæˆ -->
            </div>
        </div>

        <!-- æ§åˆ¶æ  -->
        <div class="controls" id="controls">
            <button class="ctrl-btn small" onclick="adjustSpeed(-1)">ğŸ¢</button>
            <button class="ctrl-btn main" id="micBtn" onclick="toggleVoice()">ğŸ¤</button>
            <button class="ctrl-btn small" onclick="adjustSpeed(1)">ğŸ‡</button>
            <button class="ctrl-btn small" onclick="exit()">âœ•</button>
        </div>
    </div>

    <div class="toast" id="toast"></div>

    <script>
        let scriptLines = [];
        let lineElements = [];
        let currentIndex = 0;
        let trackOffset = 0;
        let targetOffset = 0;
        let isScrolling = false;
        let scrollSpeed = 1.0; // åŸºç¡€é€Ÿåº¦å€ç‡
        let recognition = null;
        let isRecording = false;
        
        // è¯­é€Ÿæ£€æµ‹
        let lastResultTime = 0;
        let wordCount = 0;
        let wpm = 120; // é»˜è®¤è¯­é€Ÿ
        let autoScrollInterval = null;
        
        // è¡Œé«˜ç¼“å­˜ï¼ˆç”¨äºè®¡ç®—æ»šåŠ¨ä½ç½®ï¼‰
        let lineHeights = [];
        let cumulativeHeights = [];

        function start() {
            const text = document.getElementById('scriptInput').value.trim();
            if (!text) return showToast('è¯·è¾“å…¥å°è¯');

            scriptLines = text.split('\n').filter(l => l.trim());
            if (scriptLines.length < 2) return showToast('è‡³å°‘éœ€è¦2è¡Œ');

            document.getElementById('startScreen').classList.add('hidden');
            document.getElementById('prompter').classList.add('active');

            initStage();
            initVoice();
            
            // æ£€æµ‹æ˜¯å¦å»ºè®®æ¨ªå±
            if (window.innerWidth < 500 && window.innerHeight > 600) {
                document.getElementById('rotateHint').classList.add('show');
                setTimeout(() => document.getElementById('rotateHint').classList.remove('show'), 3000);
            }

            // iOSå»¶è¿Ÿå¯åŠ¨
            setTimeout(() => {
                toggleVoice();
                startAutoScroll();
            }, 500);
        }

        function initStage() {
            const track = document.getElementById('track');
            track.innerHTML = '';
            lineElements = [];
            lineHeights = [];
            cumulativeHeights = [];

            // è®¡ç®—å±å¹•ä¸­å¤®ä½ç½®ï¼ˆè§†çº¿ç„¦ç‚¹ï¼‰
            const viewportHeight = window.innerHeight;
            const centerOffset = viewportHeight * 0.6; // åä¸‹ä¸€ç‚¹ï¼ˆé»„é‡‘åˆ†å‰²ï¼‰

            scriptLines.forEach((line, index) => {
                const div = document.createElement('div');
                div.className = 'line';
                div.textContent = line;
                track.appendChild(div);
                lineElements.push(div);
            });

            // è®¡ç®—æ¯è¡Œé«˜åº¦ï¼ˆæ¸²æŸ“åï¼‰
            setTimeout(() => {
                let cumulative = 0;
                lineElements.forEach((el, i) => {
                    const height = el.offsetHeight;
                    lineHeights.push(height);
                    cumulativeHeights.push(cumulative);
                    cumulative += height;
                });

                // åˆå§‹ä½ç½®ï¼šç¬¬ä¸€è¡Œåœ¨ç„¦ç‚¹ä½ç½®
                trackOffset = centerOffset - (lineHeights[0] / 2);
                targetOffset = trackOffset;
                updateTrackPosition();
                updateActiveLine(0);
            }, 100);
        }

        // æ ¸å¿ƒï¼šå¹³æ»‘æ»šåŠ¨åˆ°æŒ‡å®šè¡Œï¼ˆå¸¦é¢„åˆ¤ï¼‰
        function scrollToLine(index, smooth = true) {
            if (index < 0 || index >= scriptLines.length) return;
            
            const viewportHeight = window.innerHeight;
            const centerOffset = viewportHeight * 0.6; // è§†çº¿ç„¦ç‚¹
            
            // ç›®æ ‡ä½ç½®ï¼šè®©å½“å‰è¡Œä½äºç„¦ç‚¹
            targetOffset = centerOffset - (cumulativeHeights[index] + lineHeights[index] / 2);
            
            if (!smooth) {
                trackOffset = targetOffset;
                updateTrackPosition();
            }
            
            updateActiveLine(index);
            updateProgress(index);
            currentIndex = index;
        }

        // è¿ç»­æ»šåŠ¨åŠ¨ç”»å¾ªç¯
        function startAutoScroll() {
            if (autoScrollInterval) cancelAnimationFrame(autoScrollInterval);
            
            function animate() {
                // æ¸è¿›å¼æ¥è¿‘ç›®æ ‡ï¼ˆç¼“åŠ¨æ•ˆæœï¼‰
                const diff = targetOffset - trackOffset;
                
                if (Math.abs(diff) > 0.5) {
                    // æ ¹æ®å·®å€¼å¤§å°è°ƒæ•´é€Ÿåº¦ï¼ˆå¿«æ¥è¿‘æ—¶å‡é€Ÿï¼‰
                    const speed = Math.max(0.5, Math.abs(diff) * 0.05) * scrollSpeed;
                    trackOffset += diff > 0 ? speed : -speed;
                    updateTrackPosition();
                }
                
                autoScrollInterval = requestAnimationFrame(animate);
            }
            animate();
        }

        function updateTrackPosition() {
            document.getElementById('track').style.transform = `translateY(${trackOffset}px)`;
        }

        function updateActiveLine(index) {
            lineElements.forEach((el, i) => {
                el.classList.remove('active', 'prev');
                if (i === index) {
                    el.classList.add('active');
                } else if (i < index) {
                    el.classList.add('prev');
                }
            });
        }

        function updateProgress(index) {
            document.getElementById('progressChip').textContent = `${index + 1}/${scriptLines.length}`;
        }

        // åŸºäºè¯­é€Ÿçš„é¢„åˆ¤æ»šåŠ¨
        function checkSpeechAndScroll(transcript) {
            const now = Date.now();
            const timeDiff = now - lastResultTime;
            lastResultTime = now;
            
            // è®¡ç®—WPMï¼ˆæ¯åˆ†é’Ÿå­—æ•°ï¼‰
            const chars = transcript.length;
            wordCount += chars;
            
            if (timeDiff > 0) {
                // ç®€å•ä¼°ç®—ï¼šä¸­æ–‡å­—ç¬¦ï¼Œ3ç§’è¯´10ä¸ªå­— = 200 WPMï¼ˆæ­£å¸¸è¯­é€Ÿï¼‰
                const instantWpm = (chars / timeDiff) * 1000 * 60 / 5; // æŒ‰å­—ç®—ï¼Œ5å­—/è¯
                wpm = Math.min(300, Math.max(80, instantWpm * 0.3 + wpm * 0.7)); // å¹³æ»‘
            }

            // æ›´æ–°UI
            document.getElementById('wpm').textContent = Math.round(wpm);
            const speedPercent = Math.min(100, (wpm / 250) * 100);
            document.getElementById('speedFill').style.width = speedPercent + '%';
            document.getElementById('hud').classList.add('show');

            // é¢„åˆ¤ç®—æ³•ï¼šæ ¹æ®è¯­é€Ÿå†³å®šä½•æ—¶å¼€å§‹æ»šåŠ¨ä¸‹ä¸€å¥
            // å‡è®¾å½“å‰è¡Œå‰©ä½™å­—æ•°ï¼Œè®¡ç®—è¯»å®Œæ‰€éœ€æ—¶é—´
            const currentLineText = scriptLines[currentIndex] || '';
            const spokenText = transcript.toLowerCase();
            const currentLineLower = currentLineText.toLowerCase();
            
            // æ£€æŸ¥æ˜¯å¦åŒ¹é…å½“å‰è¡Œæˆ–ä¸‹ä¸€è¡Œ
            if (currentLineLower && spokenText.includes(currentLineLower.slice(-4))) {
                // å¿«è¯»å®Œå½“å‰è¡Œäº†ï¼Œå¼€å§‹ç¼“æ…¢æ»šåŠ¨
                if (currentIndex < scriptLines.length - 1) {
                    // æ ¹æ®è¯­é€Ÿè°ƒæ•´æå‰é‡
                    const leadTime = wpm > 180 ? 0 : wpm > 140 ? 200 : 400; // å¿«è¯»æå‰å°‘ï¼Œæ…¢è¯»æå‰å¤š
                    
                    setTimeout(() => {
                        smoothNext();
                    }, leadTime);
                }
            }
            
            // å¦‚æœç›´æ¥åŒ¹é…ä¸‹ä¸€è¡Œï¼ˆè·³è¯»ï¼‰ï¼Œç«‹å³è·Ÿä¸Š
            if (currentIndex < scriptLines.length - 1) {
                const nextLine = scriptLines[currentIndex + 1].toLowerCase();
                if (nextLine && spokenText.includes(nextLine.slice(0, 4))) {
                    smoothNext();
                }
            }
        }

        // å¹³æ»‘ä¸‹ä¸€å¥ï¼ˆå¸¦é¢„åˆ¤åŠ¨ç”»ï¼‰
        function smoothNext() {
            if (currentIndex < scriptLines.length - 1) {
                scrollToLine(currentIndex + 1);
            }
        }

        function smoothPrev() {
            if (currentIndex > 0) {
                scrollToLine(currentIndex - 1);
            }
        }

        // é€Ÿåº¦è°ƒèŠ‚
        function adjustSpeed(delta) {
            scrollSpeed = Math.max(0.5, Math.min(3.0, scrollSpeed + delta * 0.5));
            showToast(`æ»šåŠ¨é€Ÿåº¦: ${scrollSpeed.toFixed(1)}x`);
            
            // æ˜¾ç¤ºHUD
            const hud = document.getElementById('hud');
            hud.classList.add('show');
            setTimeout(() => hud.classList.remove('show'), 2000);
        }

        // è¯­éŸ³è¯†åˆ«
        function initVoice() {
            const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
            if (!SpeechRecognition) return;

            recognition = new SpeechRecognition();
            recognition.continuous = false; // iOSå¿…é¡»false
            recognition.interimResults = true;
            recognition.lang = 'zh-CN';

            recognition.onstart = () => {
                isRecording = true;
                document.getElementById('statusDot').classList.add('active');
                document.getElementById('statusText').textContent = 'è†å¬ä¸­';
                document.getElementById('micBtn').classList.add('recording');
                lastResultTime = Date.now();
            };

            recognition.onresult = (event) => {
                let transcript = '';
                for (let i = event.resultIndex; i < event.results.length; i++) {
                    transcript += event.results[i][0].transcript;
                }
                
                // å…³é”®ï¼šå®æ—¶æ£€æµ‹å¹¶é¢„åˆ¤æ»šåŠ¨
                checkSpeechAndScroll(transcript);
            };

            recognition.onerror = (e) => {
                if (e.error === 'not-allowed') {
                    showToast('è¯·å…è®¸éº¦å…‹é£æƒé™');
                    stopVoice();
                }
            };

            recognition.onend = () => {
                if (isRecording) {
                    setTimeout(() => recognition.start(), 100);
                }
            };
        }

        function toggleVoice() {
            if (!recognition) {
                showToast('ä¸æ”¯æŒè¯­éŸ³è¯†åˆ«');
                return;
            }
            if (isRecording) {
                stopVoice();
            } else {
                recognition.start();
            }
        }

        function stopVoice() {
            isRecording = false;
            try { recognition.stop(); } catch(e) {}
            document.getElementById('statusDot').classList.remove('active');
            document.getElementById('statusText').textContent = 'æš‚åœ';
            document.getElementById('micBtn').classList.remove('recording');
        }

        // è§¦æ‘¸æ§åˆ¶
        let touchStartY = 0;
        let lastTapTime = 0;

        document.getElementById('stage').addEventListener('touchstart', (e) => {
            touchStartY = e.touches[0].clientY;
            
            // åŒå‡»éšè—/æ˜¾ç¤ºæ§åˆ¶æ 
            const now = Date.now();
            if (now - lastTapTime < 300) {
                document.getElementById('controls').classList.toggle('hidden');
            }
            lastTapTime = now;
        }, { passive: true });

        document.getElementById('stage').addEventListener('touchend', (e) => {
            const diff = touchStartY - e.changedTouches[0].clientY;
            if (Math.abs(diff) > 50) {
                if (diff > 0) smoothNext();
                else smoothPrev();
            }
        }, { passive: true });

        // é”®ç›˜æ§åˆ¶
        document.addEventListener('keydown', (e) => {
            if (!document.getElementById('prompter').classList.contains('active')) return;
            
            if (e.key === 'ArrowDown' || e.key === ' ') {
                e.preventDefault();
                smoothNext();
            } else if (e.key === 'ArrowUp') {
                e.preventDefault();
                smoothPrev();
            } else if (e.key === 'Enter') {
                toggleVoice();
            } else if (e.key === 'f') {
                toggleFullscreen();
            }
        });

        // å…¨å±åˆ‡æ¢
        function toggleFullscreen() {
            const elem = document.documentElement;
            if (!document.fullscreenElement && !document.webkitFullscreenElement) {
                if (elem.requestFullscreen) {
                    elem.requestFullscreen();
                } else if (elem.webkitRequestFullscreen) {
                    elem.webkitRequestFullscreen();
                }
                showToast('å·²å…¨å±ï¼Œæ—‹è½¬æ‰‹æœºæ¨ªå±');
            } else {
                if (document.exitFullscreen) {
                    document.exitFullscreen();
                } else if (document.webkitExitFullscreen) {
                    document.webkitExitFullscreen();
                }
            }
        }

        // ç›‘å¬å±å¹•æ—‹è½¬
        window.addEventListener('resize', () => {
            if (document.getElementById('prompter').classList.contains('active')) {
                // é‡æ–°è®¡ç®—ä½ç½®
                setTimeout(() => {
                    scrollToLine(currentIndex, false);
                }, 100);
            }
        });

        function exit() {
            if (confirm('ç¡®å®šé€€å‡ºï¼Ÿ')) {
                stopVoice();
                if (autoScrollInterval) cancelAnimationFrame(autoScrollInterval);
                document.getElementById('prompter').classList.remove('active');
                document.getElementById('startScreen').classList.remove('hidden');
                if (document.exitFullscreen) document.exitFullscreen();
            }
        }

        function showToast(msg) {
            const toast = document.getElementById('toast');
            toast.textContent = msg;
            toast.classList.add('show');
            setTimeout(() => toast.classList.remove('show'), 2000);
        }

        // é˜²æ­¢ä¼‘çœ 
        setInterval(() => {
            if (document.getElementById('prompter').classList.contains('active')) {
                window.location.href = window.location.href + '#';
                history.back();
            }
        }, 30000);
    </script>
</body>
</html>
